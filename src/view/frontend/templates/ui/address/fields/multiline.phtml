<?php declare(strict_types=1);

use MageHx\MageTemplateUtils\Model\Esc;
use MageHx\MahxCheckout\Block\Address\FieldRenderer;
use MageHx\MahxCheckout\Data\FormField\MultilineFieldMeta;

/** @var FieldRenderer $block */
/** @var Esc $esc */
/** @var Closure $classNames */
/** @var MultilineFieldMeta $fieldMeta */

$fieldConfig = $block->getFieldConfig();

if (! $fieldConfig) {
    return;
}
$fieldMeta = $fieldConfig->meta;
$wrapperClasses = $block->getWrapperElemExtraClasses();
?>
<div
    class="<?= $classNames([
        'field form-control w-full max-w-lg',
        '_required' => $fieldConfig->required,
        $wrapperClasses => $wrapperClasses
    ]) ?>"
    <?= $block->getWrapperAdditionalAttributes() ?>
>
    <?= /** @noEscape */ $block->getBeforeInputHtml() ?>
    <label class="label" for="<?= $esc->htmlAttr($fieldConfig->getFieldId() . '-0') ?>">
        <span class="<?= $classNames([
                'label-text',
                "after:content-['*'] after:text-red-500 after:ml-1" => $fieldConfig->required
            ]) ?>">
            <?= $esc->html($fieldConfig->label) ?>
        </span>
    </label>
    <div class="control space-y-2">
        <?php foreach (range(0, ($fieldMeta->lineCount) - 1) as $index): ?>
            <div class="<?= $classNames([
                    'field', '_required' => $fieldConfig->required, 'additional' => $index > 0
                ]) ?>"
            >
                <input
                    type="text"
                    class="input-text input input-bordered input-sm md:input-md w-full max-w-lg"
                    id="<?= $esc->htmlAttr($fieldConfig->getFieldId() . '-' . $index) ?>"
                    name="<?= $esc->htmlAttr($fieldConfig->name) ?>[<?= $esc->htmlAttr($index) ?>]"
                    value="<?= $esc->htmlAttr($fieldConfig->value[$index] ?? '')  ?>"
                    <?= /** @noEscape */ !$index ? $block->getInputAdditionalAttributes() : '' ?>
                />
            </div>
        <?php endforeach; ?>
    </div>
    <?= /** @noEscape */ $block->getAfterInputHtml() ?>
</div>
