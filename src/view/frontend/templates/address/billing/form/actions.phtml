<?php declare(strict_types=1);

use MageHx\HtmxActions\ViewModel\HxAttributesRenderer;
use MageHx\MageTemplateUtils\Model\Esc;
use MageHx\MageTemplateUtils\Model\ViewModelProvider;
use MageHx\MahxCheckout\ViewModel\BillingAddressFormActions;
use MageHx\MahxCheckout\ViewModel\ShowBillingForm;
use Magento\Framework\View\Element\Template;

/** @var Template $block */
/** @var Esc $esc */
/** @var ViewModelProvider $viewModelProvider */

$viewModel = $viewModelProvider->get(BillingAddressFormActions::class);
$hxAttrRenderer = $viewModelProvider->get(HxAttributesRenderer::class);
$showFormViewModel = $viewModelProvider->get(ShowBillingForm::class);
?>
<?php if ($showFormViewModel->canShowForm()): ?>
<div class="actions-toolbar max-w-lg">
    <div class="actions flex items-center justify-end space-x-4">
        <?php if ($viewModel->canShowCancelButton()): ?>
        <button
            class="action action-cancel btn btn-ghost" type="button"
            data-role="action-cancel"
            <?= $hxAttrRenderer->hxBuilder()
                ->post('mahxcheckout/billing/editBilling')
                ->target('#billing-address-section')
                ->indicator('#billing-address-section-loader')
                ->include('[name=form_key]')
                ->vals([
                    'show_form' => 0,
                    'show_cards' => (int) $viewModel->isCustomerHaveAddresses(),
                    'is_billing_same' => (int) $viewModel->isBillingSame(),
                ])
                ->swapOuterHTML()
                ->render() ?>
        >
            <?= $esc->html(__('Cancel')) ?>
        </button>
        <?php endif; ?>
        <button class="action action-update btn btn-neutral" type="button"
                data-role="action-update"
                <?= $hxAttrRenderer->hxBuilder()
                    ->post('mahxcheckout/billing/billingAddressPost')
                    ->target('#billing-address-section')
                    ->trigger('mahxcheckout-billing-validated from:body')
                    ->indicator('.save-billing-loader')
                    ->vals([
                        'show_form' => 0,
                        'show_cards' => 0,
                        'is_billing_same' => 0,
                    ])
                    ->swapOuterHTML()
                    ->render() ?>
        >
            <?= $esc->html(__('Update')) ?>
        </button>
    </div>
</div>
<?php endif; ?>
