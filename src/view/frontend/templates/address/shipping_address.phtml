<?php declare(strict_types=1);

use MageHx\MahxCheckout\ViewModel\DesignThemeInfo;
use Magento\Framework\View\Element\Template;
use MageHx\MahxCheckout\ViewModel\ShippingAddress;

/** @var Template $block */
/** @var string $nonce */
/** @var Closure $eHtmlAttr */
/** @var string $formKey */
/** @var Closure $viewModelProvider */
/** @var ShippingAddress $viewModel */
/** @var DesignThemeInfo $themeInfo */

$themeInfo = $viewModelProvider(DesignThemeInfo::class);
$viewModel = $viewModelProvider(ShippingAddress::class);
?>
<div id="shipping-address-form-container" class="checkout-shipping-address">
    <?= $block->getChildHtml('formTitle') ?>
    <?= $block->getChildHtml('guestEmailForm') ?>

    <form id="shipping-address-form" class="form form-shipping-address" x-data="ShippingAddressForm">
        <fieldset class="fieldset address space-y-2">
            <?php foreach ($viewModel->getAddressFields() as $field): ?>
                <?= $viewModel->renderField($field) ?>
            <?php endforeach; ?>
            <?= $formKey ?>
        </FIELDSET>
    </form>
    <?php if ($themeInfo->isMagentoTheme()): ?>
        <script nonce="<?= $eHtmlAttr($nonce) ?>">
            'use strict';

            require(['jquery', 'MageHx_MahxCheckout/js/page-navigation'], ($, pageNavigation) => {
                $(() => {
                    const shippingAddrForm = document.getElementById('shipping-address-form');
                    const shippingAddrFormManager = Object.assign(pageNavigation, ShippingAddressForm(shippingAddrForm));
                    shippingAddrFormManager.init();
                });
            });
        </script>
    <?php endif; ?>
</div>
